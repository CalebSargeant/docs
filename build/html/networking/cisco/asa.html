<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ASA &mdash; Caleb Sargeant&#39;s Docs 1.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ASAv" href="asav.html" />
    <link rel="prev" title="ACI" href="aci.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Caleb Sargeant's Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Networking</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Cisco</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="core-security/index.html">Core Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="routing/index.html">Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="switching/index.html">Switching</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpls/index.html">MPLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="ngfw-ngips/index.html">NGFW &amp; NGIPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="devnetday/index.html">DevNet Day</a></li>
<li class="toctree-l2"><a class="reference internal" href="aci.html">ACI</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ASA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scp">SCP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ldap-authentication">LDAP Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ldap-authorization">LDAP Authorization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#authorization-testing">Authorization Testing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#radius-aaa">RADIUS AAA</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nps">NPS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#certificates">Certificates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#intermediate-cert-with-key">Intermediate Cert with Key</a></li>
<li class="toctree-l4"><a class="reference internal" href="#csr-wildcard">CSR Wildcard</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#health">Health</a></li>
<li class="toctree-l3"><a class="reference internal" href="#host-scan">Host Scan</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#capabilities">Capabilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enabling-host-scan">Enabling Host Scan</a></li>
<li class="toctree-l4"><a class="reference internal" href="#host-scan-configuration">Host Scan Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-access-policy-configuration">Dynamic Access Policy Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#capture-file-download">Capture File Download</a></li>
<li class="toctree-l3"><a class="reference internal" href="#failover">Failover</a></li>
<li class="toctree-l3"><a class="reference internal" href="#site-to-site-vpn">Site to Site VPN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tunnel-establishing-in-asdm">Tunnel Establishing in ASDM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="asav.html">ASAv</a></li>
<li class="toctree-l2"><a class="reference internal" href="dna.html">DNA</a></li>
<li class="toctree-l2"><a class="reference internal" href="general.html">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="genie.html">Genie</a></li>
<li class="toctree-l2"><a class="reference internal" href="ise.html">ISE</a></li>
<li class="toctree-l2"><a class="reference internal" href="nexus.html">Nexus</a></li>
<li class="toctree-l2"><a class="reference internal" href="nso.html">NSO</a></li>
<li class="toctree-l2"><a class="reference internal" href="virl.html">VIRL</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mikrotik.html">Mikrotik</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fortigate.html">FortiGate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hp.html">HP Procurve</a></li>
<li class="toctree-l1"><a class="reference internal" href="../juniper.html">Juniper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ubiquiti-unifi.html">Ubiquiti UniFi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netdevops-toolchest.html">NetDevOps Tool Chest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Computing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../computing/ansible/index.html">Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/bamboo.html">Bamboo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/cloud/index.html">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/docker/index.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/kubernetes/index.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/dns.html">DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/elk-stack/index.html">ELK Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/jenkins/index.html">Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/linux/index.html">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/pentesting/index.html">Pentesting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/terraform/index.html">Terraform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/microsoft/index.html">Microsoft</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Programming</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../programming/bash.html">Bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../programming/python/index.html">Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../other/api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other/general/index.html">General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other/iperf.html">iPerf3</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Caleb Sargeant's Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Cisco</a> &raquo;</li>
      <li>ASA</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/networking/cisco/asa.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="asa">
<h1>ASA<a class="headerlink" href="#asa" title="Permalink to this heading"></a></h1>
<p>Adaptive Security Appliance</p>
<section id="scp">
<h2>SCP<a class="headerlink" href="#scp" title="Permalink to this heading"></a></h2>
<p><a class="reference external" href="https://thestupidengineer.wordpress.com/2015/04/01/scp-file-to-asa/">https://thestupidengineer.wordpress.com/2015/04/01/scp-file-to-asa/</a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Enable SCP on ASA
ssh scopy enable

# From your host / laptop / desktop / whatever
scp -v asa825-51-k8.bin username@IP_ADDRESS:disk0:asa825-51-k8.bin

# From the ASA
scp -v cisco@10.251.21.80:disk0:asa822-k8.bin asa822-k8.bin
</pre></div>
</div>
</section>
<section id="ldap-authentication">
<h2>LDAP Authentication<a class="headerlink" href="#ldap-authentication" title="Permalink to this heading"></a></h2>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h3>
<p>AAA Authentication via corp-ldap (AD servers). Enable to be kept as LOCAL authentication, otherwise, all AD users will be able to enable.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ASA(config)# no aaa authentication http console LOCAL
ASA(config)# aaa authentication http console corp-ldap LOCAL
ASA(config)# no aaa authentication ssh console LOCAL
ASA(config)# aaa authentication ssh console corp-ldap LOCAL
</pre></div>
</div>
</section>
<section id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Permalink to this heading"></a></h3>
<p><strong>AD Server Becomes Unreachable</strong></p>
<p>Run a preliminary test: we can see the aaa-server is active.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ASA# sh aaa-server corp-ldap
Server Group: corp-ldap
Server Protocol: ldap
Server Hostname: server.example.com
Server Address: x.x.x.x
Server port: 0
Server status: ACTIVE, Last transaction at 10:28:15 SAST Mon Feb 25 2019
</pre></div>
</div>
<p>Shutdown inside interface to simulate AD becoming unavailable.</p>
<p>When connecting to the ASA via SSH or HTTPS, the ASA will flag the aaa-server as FAILED.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ASA# test aaa-server authentication corp-ldap username caleb.sargeant
Server IP Address or name: server.example.com
Password: **************
INFO: Attempting Authentication test to IP address (x.x.x.x) (timeout: 12 seconds)
ERROR: Authentication Server not responding: AAA Server has been removed

ASA# sh aaa-server corp-ldap
Server Group: corp-ldap
Server Protocol: ldap
Server Hostname: server.example.com
Server Address: x.x.x.x
Server port: 0
Server status: FAILED, Server disabled at 12:28:46 SAST Tue Feb 26 2019
</pre></div>
</div>
<p>If we unshut the inside interface the ASA flags the aaa-server as ACTIVE again after the first authentication test fails.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ASA# conf t
ASA(config)# int g0/0
ASA(config-if)# no shut
ASA(config-if)# end

ASA# test aaa-server authentication corp-ldap username caleb.sargeant
Server IP Address or name: server.example.com
Password: **************
INFO: Attempting Authentication test to IP address (x.x.x.x) (timeout: 12 seconds)
ERROR: Authentication Server not responding: AAA Server has been removed

ASA# test aaa-server authentication corp-ldap username caleb.$
Server IP Address or name: server.example.com
Password: **************
INFO: Attempting Authentication test to IP address (x.x.x.x) (timeout: 12 seconds)
INFO: Authentication Successful

ASA# sh aaa-server corp-ldap
Server Group:  corp-ldap
Server Protocol: ldap
Server Hostname: server.example.com
Server Address:        x.x.x.x
Server port:   0
Server status:         ACTIVE, Last transaction at 10:28:15 SAST Mon Feb 25 2019
</pre></div>
</div>
<p><strong>Bind User Gets Deleted</strong></p>
<p>The AD Recycle Bin was enabled and he corp-ldap user was deleted.</p>
<img alt="../../_images/asa-ldap-1.png" src="../../_images/asa-ldap-1.png" />
<p>Test authentication</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ASA# test aaa-server authentication corp-ldap username caleb.sargeant
Server IP Address or name: server.example.com
Password: **************
INFO: Attempting Authentication test to IP address (x.x.x.x) (timeout: 12 seconds)
ERROR: Authentication Server not responding: AAA Server has been removed
</pre></div>
</div>
<p>AAA-Server gets marked as FAILED</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ASA# sh aaa-server corp-ldap
Server Group:  corp-ldap
Server Protocol: ldap
Server Hostname: server.example.com
Server Address:        x.x.x.x
Server port:   0
Server status:         FAILED, Server disabled at 13:44:16 SAST Tue Feb 26 2019
</pre></div>
</div>
<p>Restore the bind user from Deleted Objects in AD</p>
<img alt="../../_images/asa-ldap-2.png" src="../../_images/asa-ldap-2.png" />
<p>Test authentication again</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ASA# test aaa-server authentication corp-ldap username caleb.sargeant
Server IP Address or name: server.example.com
Password: **************
INFO: Attempting Authentication test to IP address (x.x.x.x) (timeout: 12 seconds)
INFO: Authentication Successful
</pre></div>
</div>
<p><strong>User Account(s) Get(s) Deleted</strong></p>
<p>This one is obvious. We will be able to log in as a different user. If all users are deleted, we can have the ASA’s inside interface cable be unplugged, or console into the ASA and shut the inside interface (or on the switch). When authenticating with the interface shut, the ASA will flag the aaa-server as FAILED and we will be able to login with root (LOCAL) again. See the above tests for proof.</p>
</section>
</section>
<section id="ldap-authorization">
<h2>LDAP Authorization<a class="headerlink" href="#ldap-authorization" title="Permalink to this heading"></a></h2>
<section id="authorization-testing">
<h3>Authorization Testing<a class="headerlink" href="#authorization-testing" title="Permalink to this heading"></a></h3>
<p>We need to deauthorize other users from accessing the ASA. We will use “John Doe” from Finance to test and change the configuration on the ASA and on AD accordingly. Even though SSH access to the ASA without logging in or enabling is in non-privileged mode, only members in #Infrastructure should be able to access the ASA.</p>
<p>John Doe is allowed to SSH into the ASA, but because we left <code class="docutils literal notranslate"><span class="pre">enable</span></code> as LOCAL authentication, John Doe is unable to login.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>caleb.sargeant@MacBook:~$ ssh john.doe@vpn.example.com
john.doe@vpn.example.com&#39;s password:
User john.doe logged in to ASA
Logins over the last 34 days: 1.
Failed logins since the last login: 0.
Type help or &#39;?&#39; for a list of available commands.
ASA&gt; login
Username: john.doe
Password: *********
%Login failed
ERROR: Invalid username
</pre></div>
</div>
<p>John Doe is allowed to configure the ASA through ASDM</p>
<img alt="../../_images/asa-ldap-3.png" src="../../_images/asa-ldap-3.png" />
<p>To prevent this, we create a new aaa-server and be more specific with the ldap-base-dn. Only members inside the #Infrastructure OU will be able to log in.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>aaa-server asa-ldap protocol ldap
aaa-server asa-ldap (inside) host server.example.com
  ldap-scope subtree
  ldap-base-dn ou=REDACTED, dc=REDACTED, dc=com
  ldap-login-dn cn=corp-ldap, dc=REDACTED, dc=com
  ldap-login-password **********
  ldap-naming-attribute sAMAccountName
  server-type microsoft
exit

aaa authentication http console asa-ldap LOCAL
aaa authentication ssh console asa-ldap LOCAL
</pre></div>
</div>
</section>
</section>
<section id="radius-aaa">
<h2>RADIUS AAA<a class="headerlink" href="#radius-aaa" title="Permalink to this heading"></a></h2>
<p>With RADIUS Authentication, we are able to specify which Windows group a user needs to be part of to log in to the ASA.</p>
<section id="id1">
<h3>Configuration<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p>Configure the aaa-server &amp; enable authentication through RADIUS</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>aaa-server asa-radius protocol radius
aaa-server asa-radius (inside) host server.example.com
key *****
authentication-port 1812
accounting-port 1813

no aaa authentication http console LOCAL
aaa authentication http console asa-radius LOCAL
no aaa authentication ssh console LOCAL
aaa authentication ssh console asa-radius LOCAL

# View packets
 debug radius all
</pre></div>
</div>
</section>
<section id="nps">
<h3>NPS<a class="headerlink" href="#nps" title="Permalink to this heading"></a></h3>
<p>Add a RADIUS Client</p>
<img alt="../../_images/asa-radius-aaa-1.png" src="../../_images/asa-radius-aaa-1.png" />
<img alt="../../_images/asa-radius-aaa-2.png" src="../../_images/asa-radius-aaa-2.png" />
<p>Create a Network Policy (skip Connection Request Policy). The Client Friendly Name optional and perhaps not recommended so that we can use one policy for all network devices</p>
<img alt="../../_images/asa-radius-aaa-3.png" src="../../_images/asa-radius-aaa-3.png" />
<p>Enable only Unencrypted authentication (PAP, SPAP)</p>
<img alt="../../_images/asa-radius-aaa-4.png" src="../../_images/asa-radius-aaa-4.png" />
<p>NAS Port Type is Virtual (VPN)</p>
<img alt="../../_images/asa-radius-aaa-5.png" src="../../_images/asa-radius-aaa-5.png" />
<p>Service-Type is Administrative</p>
<img alt="../../_images/asa-radius-aaa-6.png" src="../../_images/asa-radius-aaa-6.png" />
</section>
</section>
<section id="certificates">
<h2>Certificates<a class="headerlink" href="#certificates" title="Permalink to this heading"></a></h2>
<section id="intermediate-cert-with-key">
<h3>Intermediate Cert with Key<a class="headerlink" href="#intermediate-cert-with-key" title="Permalink to this heading"></a></h3>
<p>Create a PKCS #12 Certificate which we will use to import into the ASA:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>openssl pkcs12 -export -in wildcard.corp.example.com.crt -inkey wildcard.corp.example.com.key -out wildcard.corp.example.com.p12
Enter Export Password: secret
Verifying - Enter Export Password: secret
</pre></div>
</div>
<p>To read the certificate:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat wildcard.corp.example.com.p12 | base64
REDACTED (long string)
</pre></div>
</div>
<p>On the ASA via CLI (don’t use command <code class="docutils literal notranslate"><span class="pre">nointeractive</span></code>, which is the default behaviour via ASDM):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ASA/sec/actNoFailover(config)# crypto ca import 2018-10-TrustPoint pkcs12 &quot;secret&quot;

Enter the base 64 encoded pkcs12.
End with the word &quot;quit&quot; on a line by itself:
REDACTED (long string)
quit
% You already have RSA or ECDSA keys named 2018-10-TrustPoint.
% If you replace them, all device certs issued using these keys
% will be removed.
% Do you really want to replace them? [yes/no]: yes

Trustpoint &#39;2018-10-TrustPoint&#39; is a subordinate CA and holds a non self-signed certificate.

Trustpoint CA certificate accepted.
INFO: Import PKCS12 operation completed successfully

ASA/sec/actNoFailover(config)# crypto ca trustpoint 2018-10-TrustPoint
ASA/sec/actNoFailover(config-ca-trustpoint)#   revocation-check none
ASA/sec/actNoFailover(config-ca-trustpoint)#   id-usage ssl-ipsec
ASA/sec/actNoFailover(config-ca-trustpoint)#   exit
ASA/sec/actNoFailover(config)# ssl trust-point 2018-10-TrustPoint outside
ASA/sec/actNoFailover(config)# ssl trust-point 2018-10-TrustPoint inside
</pre></div>
</div>
<p>Now, when connecting to ASA via RA VPN, as long as you are using a corp.example.com hostname (example vpn.corp.example.com), you will not receive any certificate errors, because the wildcard.corp.example.com certificate is being used.</p>
</section>
<section id="csr-wildcard">
<h3>CSR Wildcard<a class="headerlink" href="#csr-wildcard" title="Permalink to this heading"></a></h3>
<p><strong>Generate the key</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>crypto key generate rsa label 2018-10-TrustPoint modulus 2048 noconfirm
</pre></div>
</div>
<p><strong>Create the Identity Certificate</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>crypto ca trustpoint 2018-10-TrustPoint
  revocation-check none
  keypair -corp.TrustPoint-2018
  id-usage ssl-ipsec
  fqdn vpn.corp.example.com
  subject-name CN=asa,CN=vpn,CN=vpn-out,CN=vpn-in,O=Example,C=US
  enrollment terminal
  no ca-check
</pre></div>
</div>
<p><strong>Generate the CSR</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>crypto ca enroll 2018-10-TrustPoint noconfirm
  -----BEGIN CERTIFICATE-----
  ASA-generated random stuff
  -----END CERTIFICATE-----
# Copy the generated CSR to your clipboard
</pre></div>
</div>
<p><strong>Generate a Certificate from the 3rd Party CA</strong></p>
<p>Go to <a class="reference external" href="https://www.digicert.com">https://www.digicert.com</a>. We will be requesting a duplicate wildcard certificate.</p>
<ul class="simple">
<li><p>Paste the ASA-generated CSR into the <em>Add Your CSR field</em>.</p></li>
</ul>
<img alt="../../_images/asa-cert-1.png" src="../../_images/asa-cert-1.png" />
<ul class="simple">
<li><p>Input all the hostnames in FQDN format into the <em>Other Hostnames (SANs) field</em>. In this example, I inputted the below, not “vpn.corp.example.com”, as per the below screenshot. This should match up with the <em>subject-name</em> command from when we created the <em>Identity Certificate</em>.</p>
<ul>
<li><p>vpn-out.corp.example.com</p></li>
<li><p>asa.corp.example.com</p></li>
<li><p>vpn.corp.example.com</p></li>
<li><p>vpn-in.corp.example.com</p></li>
</ul>
</li>
</ul>
<img alt="../../_images/asa-cert-2.png" src="../../_images/asa-cert-2.png" />
<ul class="simple">
<li><p>Select SHA-256 from the <em>Signature Hash</em> drop-down menu.</p></li>
<li><p>Select Cisco from the <em>Server Platform</em> list.</p></li>
</ul>
<p><strong>Install the Certificate from the 3rd Party CA</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>crypto ca import 2018-10-TrustPoint certificate nointeractive
  -----BEGIN CERTIFICATE-----
  DigiCert-generated random stuff
  -----END CERTIFICATE-----
quit
</pre></div>
</div>
<p><strong>Attach the Certificate to the Interfaces for SSL Authentication</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ssl trust-point 2018-10-TrustPoint inside
ssl trust-point 2018-10-TrustPoint outside
</pre></div>
</div>
</section>
</section>
<section id="health">
<h2>Health<a class="headerlink" href="#health" title="Permalink to this heading"></a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Uptime
sh ver | grep up

# Memory
sh mem | grep Used

# CPU
sh cpu

# Failover
sh failover state
</pre></div>
</div>
</section>
<section id="host-scan">
<h2>Host Scan<a class="headerlink" href="#host-scan" title="Permalink to this heading"></a></h2>
<section id="capabilities">
<h3>Capabilities<a class="headerlink" href="#capabilities" title="Permalink to this heading"></a></h3>
<p>Host Scan is capable of checking for the following endpoint attributes:</p>
<ul class="simple">
<li><p>Registry</p></li>
<li><p>File</p></li>
<li><p>Process</p></li>
<li><p>AntiVirus</p></li>
<li><p>AntiSpyware</p></li>
<li><p>Personal Firewall</p></li>
</ul>
<p>DAP is capable of checking for the following endpoint attributes:</p>
<ul class="simple">
<li><p>Anti-Spyware (through Host Scan)</p></li>
<li><p>Anti-Virus (through Host Scan)</p></li>
<li><p>AnyConnect (version, platform, etc.)</p></li>
<li><p>Application (VPN Application type, eg. AnyConnect or Clientless SSL)</p></li>
<li><p>File (through Host Scan)</p></li>
<li><p>Device (Host Name, MAC Address, BIOS Serial Number, etc)</p></li>
<li><p>NAC (Posture Status)</p></li>
<li><p>Operating System</p></li>
<li><p>Personal Firewall (through Host Scan)</p></li>
<li><p>Multiple Certificate Authentication (when MCA is the authentication method for AnyConnect)</p></li>
<li><p>Policy ( ? )</p></li>
<li><p>Process (through Host Scan)</p></li>
<li><p>Registry (through Host Scan)</p></li>
</ul>
<p>The below guide demonstrates how to install and configure Host Scan &amp; modifying the matching DAP policies on Cisco ASA. We will be enabling Host Scan to check if the endpoint has been added to the domain. For Windows, the best way of doing this is for Host Scan to check the registry setting for the <em>DomainName</em> value. On Mac, the only way (/best way) of doing this is for Host Scan to check that a file exists. There are no official methods of checking that a Mac has been added to the domain through Host Scan, as Macs get added to the domain through a 3rd party application (like Centrify) to Cisco.</p>
</section>
<section id="enabling-host-scan">
<h3>Enabling Host Scan<a class="headerlink" href="#enabling-host-scan" title="Permalink to this heading"></a></h3>
<p>First upload the image, then enable hostscan:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>webvpn
hostscan image disk0:/hostscan_4.3.05047-k9.pkg
hostscan enable
</pre></div>
</div>
</section>
<section id="host-scan-configuration">
<h3>Host Scan Configuration<a class="headerlink" href="#host-scan-configuration" title="Permalink to this heading"></a></h3>
<p>Add a <em>Basic Host</em> Scan item:</p>
<img alt="../../_images/asa-host-scan-1.png" src="../../_images/asa-host-scan-1.png" />
<p><strong>Windows:</strong></p>
<p>n ASDM, add a Basic Host Scan item under <em>Configuration &gt; Remote Access VPN &gt; Secure Desktop Manager &gt; Host Scan &gt; Basic Host Scan &gt; Add &gt; Registry</em>:</p>
<p>Entry Path: <code class="docutils literal notranslate"><span class="pre">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Group</span> <span class="pre">Policy\Datastore\Machine\0\DomainName</span></code></p>
<p><strong>Mac:</strong></p>
<p>In ASDM, add a Basic Host Scan item under <em>Configuration &gt; Remote Access VPN &gt; Secure Desktop Manager &gt; Host Scan &gt; Basic Host Scan &gt; Add &gt; File</em>:</p>
<p>File Path: <code class="docutils literal notranslate"><span class="pre">/Applications/Utilities/Centrify/AD</span> <span class="pre">Check.app</span></code></p>
</section>
<section id="dynamic-access-policy-configuration">
<h3>Dynamic Access Policy Configuration<a class="headerlink" href="#dynamic-access-policy-configuration" title="Permalink to this heading"></a></h3>
<p>In ASDM, add one group for Windows and one group for Mac, per policy entry. Then add an endpoint attribute per DAP policy.</p>
<p>We have to duplicate the DAP Policies, creating one policy for Mac and one for Windows, because when the endpoint connects through VPN, the ASA compares the endpoint’s attributes against each DAP Policy. We, unfortunately, cannot add a <em>File</em> and <em>Registry endpoint attribute</em> and modify the <em>Logical Operation</em> to “or” instead of “and”. The only way we can change the <em>Logical Operation</em> to “and”, is to have multiple of the same endpoint attribute per policy, however, this would be nonsensical, as the <em>File endpoint attribute</em> is only applicable to Mac (in our case) and the <em>Registry endpoint attribute</em> is only applicable to Windows.</p>
<img alt="../../_images/asa-host-scan-2.png" src="../../_images/asa-host-scan-2.png" />
<p><strong>Windows</strong></p>
<p>Endpoint Attribute Type: Registry</p>
<p>Value: string = corp.example.com</p>
<p><strong>Mac</strong></p>
<p>Endpoint Attribute Type: File=</p>
</section>
</section>
<section id="capture-file-download">
<h2>Capture File Download<a class="headerlink" href="#capture-file-download" title="Permalink to this heading"></a></h2>
<p>Go to <a class="reference external" href="https://IPADDRESS/CONTEXT/capture/CAPTURENAME/pcap">https://IPADDRESS/CONTEXT/capture/CAPTURENAME/pcap</a>
(Delete <code class="docutils literal notranslate"><span class="pre">/context</span></code> if a single context)</p>
</section>
<section id="failover">
<h2>Failover<a class="headerlink" href="#failover" title="Permalink to this heading"></a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>### ASA1
# Setup failover interface
en
conf t
hostname ASA1
failover lan unit pri
int g0/6
no shut

# Assign failover IP Address
failover lan int FAILOVER g0/6
failover int ip FAILOVER 10.255.255.1 255.255.255.252 standby 10.255.255.2
failover key MySecretKey
failover link FAILOVER

# Configure Outside IP Address on ASA1
int g0/4
ip add 100.100.100.1 255.255.255.248 standby 100.100.100.2
nameif outside1
no shut

# Configure Inside IP Address on ASA1
int g0/0
ip add 10.0.0.1 255.255.255.0 standby 10.0.0.2
nameif inside1
security-level 100
no shut

# Enable failover
failover

### ASA2
# Setup failover interface
en
conf t
hostname ASA2
failover lan unit secondary
int g0/6
no shut
failover lan int FAILOVER g0/6

# Assign failover IP Address
failover int ip FAILOVER 10.255.255.1 255.255.255.252 standby 10.255.255.2
failover key MySecretKey
failover link FAILOVER

# Enable failover
failover
</pre></div>
</div>
</section>
<section id="site-to-site-vpn">
<h2>Site to Site VPN<a class="headerlink" href="#site-to-site-vpn" title="Permalink to this heading"></a></h2>
<p># Show tunnel uptime
show vpn-sessiondb detail l2l filter ipaddress PEERADDRESS | i Conn|Dur
# Re-establish tunnel (be careful!)
Clear ipsec sa peer PEERADDRESS</p>
<section id="tunnel-establishing-in-asdm">
<h3>Tunnel Establishing in ASDM<a class="headerlink" href="#tunnel-establishing-in-asdm" title="Permalink to this heading"></a></h3>
<img alt="../../_images/asa-tunnel-establish.png" src="../../_images/asa-tunnel-establish.png" />
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="aci.html" class="btn btn-neutral float-left" title="ACI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="asav.html" class="btn btn-neutral float-right" title="ASAv" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Caleb Sargeant.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>