<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mikrotik &mdash; Caleb Sargeant&#39;s Docs 1.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FortiGate" href="fortigate.html" />
    <link rel="prev" title="VIRL" href="cisco/virl.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Caleb Sargeant's Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Networking</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cisco/index.html">Cisco</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Mikrotik</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#first-time-setup">First Time Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#securing-the-router">Securing the Router</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-bridge">Configuring the Bridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-outside-interface">Configuring the Outside Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-dhcp-server-for-clients">Configuring DHCP Server for Clients</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-nat">Configure NAT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deny-catch-all-firewall-rules">Deny Catch all Firewall Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upgrading-the-router">Upgrading the Router</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upgrading-the-firmware">Upgrading the Firmware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-the-identity">Setting the Identity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#users-groups-ssh-keys">Users &amp; Groups &amp; SSH Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="#https-access-to-router">HTTPS Access to Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="#backup-and-restore">Backup and Restore</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resetting-router">Resetting Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="#netinstall">Netinstall</a></li>
<li class="toctree-l2"><a class="reference internal" href="#licensing">Licensing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dhcp">DHCP</a></li>
<li class="toctree-l2"><a class="reference internal" href="#arp">ARP</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bridging">Bridging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#station-mode">Station Mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#routing">Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tunneling-vpn">Tunneling / VPN</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-vpn">What is VPN?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ikev2-ipsec">IKEv2 IPSec</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pptp">PPTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#l2tp-site-to-site">L2TP Site-to-Site</a></li>
<li class="toctree-l3"><a class="reference internal" href="#l2tp-client-to-site">L2TP Client-to-Site</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gre-ipsec">GRE IPSec</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sstp">SSTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pppoe">PPPoE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#l2tp-ports-and-protocols">L2TP Ports and Protocols</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#firewall">Firewall</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basics">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#layer-3-chains">Layer 3 Chains</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connection-states">Connection States</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rules">Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redirect-dns-to-router-s-dns">Redirect DNS to Router’s DNS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#destination-nat">Destination NAT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fasttrack">FastTrack</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#qos">QoS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-queue">Simple Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="#burst">Burst</a></li>
<li class="toctree-l3"><a class="reference internal" href="#per-connection-queue-pcq">Per Connection Queue (PCQ)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tools">Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ping">Ping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#traceroute">Traceroute</a></li>
<li class="toctree-l3"><a class="reference internal" href="#profile">Profile</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#emails">Emails</a></li>
<li class="toctree-l2"><a class="reference internal" href="#netwatch">Netwatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="#monitoring">Monitoring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#torch">Torch</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graphing">Graphing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-dude">The Dude</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wireless">Wireless</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#terminology">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#station">Station</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mac-filtering">Mac Filtering</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fortigate.html">FortiGate</a></li>
<li class="toctree-l1"><a class="reference internal" href="hp.html">HP Procurve</a></li>
<li class="toctree-l1"><a class="reference internal" href="juniper.html">Juniper</a></li>
<li class="toctree-l1"><a class="reference internal" href="ubiquiti-unifi.html">Ubiquiti UniFi</a></li>
<li class="toctree-l1"><a class="reference internal" href="netdevops-toolchest.html">NetDevOps Tool Chest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Computing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../computing/ansible/index.html">Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/bamboo.html">Bamboo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/cloud/index.html">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/containerisation/index.html">Containerisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/dns.html">DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/jenkins/index.html">Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/linux/index.html">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/pentesting/index.html">Pentesting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/terraform/index.html">Terraform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/microsoft/index.html">Microsoft</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Programming</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../programming/bash.html">Bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programming/python/index.html">Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../other/api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other/general/index.html">General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other/iperf.html">iPerf3</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Caleb Sargeant's Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Mikrotik</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/networking/mikrotik.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mikrotik">
<h1>Mikrotik<a class="headerlink" href="#mikrotik" title="Permalink to this headline"></a></h1>
<section id="first-time-setup">
<h2>First Time Setup<a class="headerlink" href="#first-time-setup" title="Permalink to this headline"></a></h2>
<section id="securing-the-router">
<h3>Securing the Router<a class="headerlink" href="#securing-the-router" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Disable wireless if not using it</p></li>
<li><p>IP &gt; Services (disable telnet and stuff, only allow certain addresses)</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip service print
</pre></div>
</div>
<ul class="simple">
<li><p>System &gt; Password (change the password)</p></li>
<li><p>System &gt; Users &gt; double click on the user and set the allowed addresses</p></li>
</ul>
<img alt="../_images/mikrotik-securing-1.png" src="../_images/mikrotik-securing-1.png" />
</section>
<section id="configuring-the-bridge">
<h3>Configuring the Bridge<a class="headerlink" href="#configuring-the-bridge" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>IP &gt; Addresses (giving the bridge an address that will be used as gateway)</p></li>
</ul>
<img alt="../_images/mikrotik-bridge-1.png" src="../_images/mikrotik-bridge-1.png" />
</section>
<section id="configuring-the-outside-interface">
<h3>Configuring the Outside Interface<a class="headerlink" href="#configuring-the-outside-interface" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Disable ether1 in Bridge</p></li>
<li><p>IP &gt; DHCP Client</p></li>
</ul>
<img alt="../_images/mikrotik-dhcp-client-1.png" src="../_images/mikrotik-dhcp-client-1.png" />
</section>
<section id="configuring-dhcp-server-for-clients">
<h3>Configuring DHCP Server for Clients<a class="headerlink" href="#configuring-dhcp-server-for-clients" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>IP &gt; DHCP Server &gt; DHCP Setup</p></li>
<li><p>DHCP Server Interface: bridgeLocal</p></li>
<li><p>DHCP Address Space: 172.16.0.0/24</p></li>
<li><p>Gateway for DHCP Network &gt; 172.16.0.1</p></li>
<li><p>DHCP Relay &gt; delete this</p></li>
</ul>
</section>
<section id="configure-nat">
<h3>Configure NAT<a class="headerlink" href="#configure-nat" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>IP &gt; Firewall &gt; NAT</p></li>
<li><p>Chain: srcnat</p></li>
<li><p>Action: masquerade</p></li>
</ul>
</section>
<section id="deny-catch-all-firewall-rules">
<h3>Deny Catch all Firewall Rules<a class="headerlink" href="#deny-catch-all-firewall-rules" title="Permalink to this headline"></a></h3>
<img alt="../_images/mikrotik-firewall-1.png" src="../_images/mikrotik-firewall-1.png" />
</section>
<section id="upgrading-the-router">
<h3>Upgrading the Router<a class="headerlink" href="#upgrading-the-router" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>System &gt; Packages &gt; Check For Updates &gt; Download&amp;install</p></li>
</ul>
</section>
<section id="upgrading-the-firmware">
<h3>Upgrading the Firmware<a class="headerlink" href="#upgrading-the-firmware" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>System &gt; RouterBOARD &gt; Upgrade</p></li>
<li><p>System &gt; Reboot</p></li>
</ul>
</section>
<section id="setting-the-identity">
<h3>Setting the Identity<a class="headerlink" href="#setting-the-identity" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>System &gt; Identity</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>system identity <span class="nb">set</span> <span class="nv">name</span><span class="o">=</span>Caleb
</pre></div>
</div>
</section>
</section>
<section id="users-groups-ssh-keys">
<h2>Users &amp; Groups &amp; SSH Keys<a class="headerlink" href="#users-groups-ssh-keys" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>System &gt; Users (here you can admin all your users nad groups, give read only access, etc.)</p></li>
<li><p>For SSH keys upload your private key file that you generated</p></li>
<li><p>Allow/Deny SSH password Login to disable/enable ssh key login only</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip ssh <span class="nb">set</span> always-allow-password-login<span class="o">=</span>no
ip ssh print
</pre></div>
</div>
</section>
<section id="https-access-to-router">
<h2>HTTPS Access to Router<a class="headerlink" href="#https-access-to-router" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>System &gt; Certificates</p></li>
<li><p>Country: ZA</p></li>
<li><p>Key Size: 2048</p></li>
<li><p>Days Valid: 365</p></li>
<li><p>Key Usage: tls server</p></li>
<li><p>Sign</p></li>
<li><p>IP &gt; Services &gt; enable www-ssl and select the certificate</p></li>
</ul>
</section>
<section id="backup-and-restore">
<h2>Backup and Restore<a class="headerlink" href="#backup-and-restore" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Files &gt; Backup</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>system backup save <span class="nv">encryption</span><span class="o">=</span>aes-sha256 <span class="nv">name</span><span class="o">=</span>backup

<span class="c1"># or (takes a lot of load)</span>
<span class="nb">export</span>
<span class="nb">export</span> <span class="nv">file</span><span class="o">=</span><span class="nb">export</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Files &gt; Restore</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>import file-name<span class="o">=</span>export.rsc

<span class="c1"># or open the file with text editor and copy paste</span>
</pre></div>
</div>
</section>
<section id="resetting-router">
<h2>Resetting Router<a class="headerlink" href="#resetting-router" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Press the reset button until the light stops flashing by unplugging the power, holding the button and powering on</p></li>
<li><p>System &gt; Reset Configuration</p></li>
</ul>
</section>
<section id="netinstall">
<h2>Netinstall<a class="headerlink" href="#netinstall" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Only works on ether1</p></li>
<li><p>Formats the drive, keeps license key and RouterBOOT settings</p></li>
<li><p>Download Netinstall from Mikrotik site and open it</p></li>
<li><p>Click Net booting &gt; boot server enabled &gt; put in IP Address of router</p></li>
</ul>
</section>
<section id="licensing">
<h2>Licensing<a class="headerlink" href="#licensing" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>System &gt; License</p></li>
<li><p><a class="reference external" href="https://wiki.mikrotik.com/wiki/Manual:License">https://wiki.mikrotik.com/wiki/Manual:License</a></p></li>
</ul>
</section>
<section id="dhcp">
<h2>DHCP<a class="headerlink" href="#dhcp" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Discover: broadcast takes place over network</p></li>
<li><p>Offer: the server offers the client a lease</p></li>
<li><p>Request: client requests the lease from the server</p></li>
<li><p>Acknowledge: server sends client ack for the lease</p></li>
</ul>
<p>IP &gt; DHCP Server &gt; DHCP Setup</p>
</section>
<section id="arp">
<h2>ARP<a class="headerlink" href="#arp" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>ARP Request: gets broadcast to find out who the ip address of the mac address is of the ip address</p></li>
<li><p>Server puts the clients mac address and ip address in its arp table and replies to client</p></li>
<li><p>Mikrotik recommends setting your interface arp to reply-only so that it doesnt learn new arps from anywhere else</p></li>
</ul>
<p>IP &gt; ARP</p>
</section>
<section id="bridging">
<h2>Bridging<a class="headerlink" href="#bridging" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Ports in a bridge behave as a switch at layer 2</p></li>
</ul>
<p>Bridge</p>
<section id="station-mode">
<h3>Station Mode<a class="headerlink" href="#station-mode" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Interfaces &gt; wlan1 &gt; mode: station bridge</p></li>
<li><p>Scan and select the WLAN you want to connect to</p></li>
<li><p>this will allow one router to connect to the other one wirelessly: ISP &lt;-&gt; R1 &lt;-&gt; wifi &lt;-&gt; R2 &lt;-&gt; PC</p></li>
</ul>
</section>
</section>
<section id="routing">
<h2>Routing<a class="headerlink" href="#routing" title="Permalink to this headline"></a></h2>
<ul>
<li><p>Exterior Gateway Protocol (EGP):</p>
<blockquote>
<div><ul class="simple">
<li><p>BGP</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Interior Gateway Protocols (IGP):</p>
<blockquote>
<div><ul class="simple">
<li><p>RIP</p></li>
<li><p>IGRP (Cisco)</p></li>
<li><p>EIGRP (Cisco)</p></li>
<li><p>OSPF</p></li>
<li><p>IS-IS</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>IP &gt; Routes</p>
</section>
<section id="tunneling-vpn">
<h2>Tunneling / VPN<a class="headerlink" href="#tunneling-vpn" title="Permalink to this headline"></a></h2>
<section id="what-is-vpn">
<h3>What is VPN?<a class="headerlink" href="#what-is-vpn" title="Permalink to this headline"></a></h3>
<p><strong>Private WAN:</strong></p>
<ul class="simple">
<li><p>Secure</p></li>
<li><p>Confidential</p></li>
<li><p>But expensive</p></li>
</ul>
<p>Alternative to private WAN is the internet. However, the internet is unsecure and we need a VPN protocol to run to have a secure data transfer from A to B</p>
<p><strong>VPN Features:</strong></p>
<ul class="simple">
<li><p>Confidentiality: preventing anyone from reading your data using encryption protocols</p></li>
<li><p>Authentication: verifying that the router/firewall or remote user that is sending VPN traffic is a legitimate device or router</p></li>
<li><p>Integrity: verifying that the VPN packet wasn’t changed during transit</p></li>
<li><p>Anty-replay: preventing someone from capturing traffic and resending it, trying to appear as a legitimate device/user</p></li>
</ul>
</section>
<section id="ikev2-ipsec">
<h3>IKEv2 IPSec<a class="headerlink" href="#ikev2-ipsec" title="Permalink to this headline"></a></h3>
<ul>
<li><p>All configuration is done under IP &gt; IPsec</p>
<blockquote>
<div><ul class="simple">
<li><p>Note, according to this Cisco document (<a class="reference external" href="https://tools.cisco.com/security/center/resources/next_generation_cryptography">https://tools.cisco.com/security/center/resources/next_generation_cryptography</a>), the following algorithms are acceptable:</p></li>
<li><p>Authentication: sha384 (384 wasnt available in the below example)</p></li>
<li><p>Encryption: aes-256 cbc</p></li>
<li><p>Hashing: sha384</p></li>
<li><p>DH group: modp3084</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p><strong>Proposal</strong></p>
<p>Select the auth. Algorithm and encr. Algorithm thats NGE acceptable.</p>
<img alt="../_images/mikrotik-ikev2-ipsec-1.png" src="../_images/mikrotik-ikev2-ipsec-1.png" />
<p><strong>Profile</strong></p>
<p>Select the Hash Algorithm, Encryption Algorithm and DH group thats NGE acceptable.</p>
<img alt="../_images/mikrotik-ikev2-ipsec-2.png" src="../_images/mikrotik-ikev2-ipsec-2.png" />
<p><strong>Peer</strong></p>
<p>Enter the peer address, select the profile you created and set the exchange mode to IKEv2</p>
<img alt="../_images/mikrotik-ikev2-ipsec-3.png" src="../_images/mikrotik-ikev2-ipsec-3.png" />
<p><strong>Identities</strong></p>
<p>Set a PSK and select the correct peer you created.</p>
<img alt="../_images/mikrotik-ikev2-ipsec-4.png" src="../_images/mikrotik-ikev2-ipsec-4.png" />
<p><strong>Policy</strong></p>
<p>Select the peer you created, set the source and dest addresses, check tunnel.</p>
<img alt="../_images/mikrotik-ikev2-ipsec-5.png" src="../_images/mikrotik-ikev2-ipsec-5.png" />
<p>Action encrypt:</p>
<img alt="../_images/mikrotik-ikev2-ipsec-6.png" src="../_images/mikrotik-ikev2-ipsec-6.png" />
<p><strong>Firewall &amp; NAT</strong></p>
<p>Create a srcnat rule with action accept to no-nat the traffic. Put this rule on top.</p>
<img alt="../_images/mikrotik-ikev2-ipsec-7.png" src="../_images/mikrotik-ikev2-ipsec-7.png" />
<p>Create a firewall rule to allow the traffic. Action accept, chain forward.</p>
<img alt="../_images/mikrotik-ikev2-ipsec-8.png" src="../_images/mikrotik-ikev2-ipsec-8.png" />
</section>
<section id="pptp">
<h3>PPTP<a class="headerlink" href="#pptp" title="Permalink to this headline"></a></h3>
<p><strong>What is PPTP:</strong></p>
<ul class="simple">
<li><p>PPTP means Point-to-Point Tunneling Protocol</p></li>
<li><p>PPTP was introduced in 1995</p></li>
<li><p>PPTP is considered a weak VPN protocol in terms of security</p></li>
<li><p>PPTP uses port 1723 to establish a peer connection and uses port 47 (GRE)</p></li>
<li><p>On Mikrotik, PPTP supports site to site and client to site VPN tunneling</p></li>
</ul>
<p><strong>Advantages:</strong></p>
<ul class="simple">
<li><p>Easy configuration</p></li>
<li><p>Very fast VPN protocol</p></li>
<li><p>Available on most platforms</p></li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul class="simple">
<li><p>PPTP encryption is weak</p></li>
<li><p>A PPTP connection can be exploited by cybercriminals with malicious attacks</p></li>
<li><p>A PPTP connetion can be blocked quite easily by firewalls</p></li>
<li><p>A router with PPTP passthrough is usually required since PPTP doesn’t natively work with NAT</p></li>
</ul>
<p><strong>Site to Site Configuration:</strong></p>
<ul>
<li><p>On the main router:</p></li>
<li><p>PPP &gt; Interface &gt; PPTP Server</p></li>
<li><p>PPP &gt; Secrets &gt; +</p>
<blockquote>
<div><ul class="simple">
<li><p>Name: put a name here</p></li>
<li><p>Password: put a password here</p></li>
<li><p>Profile: select the default-encryption profile or a profile you created</p></li>
<li><p>Local address: the local address of your router</p></li>
<li><p>Remote address: the local address of the other router</p></li>
</ul>
</div></blockquote>
</li>
<li><p>On the branch router:</p></li>
<li><p>PPP &gt; Interface &gt; + &gt; PPTP Client &gt; Dial Out</p>
<blockquote>
<div><ul class="simple">
<li><p>Connect to: public IP of main router</p></li>
<li><p>User: the username</p></li>
<li><p>Password: the password</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Add a route to the local network on each router (IP &gt; Route)</p></li>
</ul>
</section>
<section id="l2tp-site-to-site">
<h3>L2TP Site-to-Site<a class="headerlink" href="#l2tp-site-to-site" title="Permalink to this headline"></a></h3>
<p><strong>On your main router:</strong></p>
<ul>
<li><p>Create the PPP Profile</p>
<blockquote>
<div><ul class="simple">
<li><p>PPP &gt; Profiles</p></li>
<li><p>Name: Put the name of the ppp profile</p></li>
<li><p>Protocols tab &gt; Use Encryption: yes</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<img alt="../_images/mikrotik-l2tp-l2l-3.png" src="../_images/mikrotik-l2tp-l2l-3.png" />
<img alt="../_images/mikrotik-l2tp-l2l-4.png" src="../_images/mikrotik-l2tp-l2l-4.png" />
<ul>
<li><p>Enabling L2TP Server with IPSec</p>
<blockquote>
<div><ul class="simple">
<li><p>PPP &gt; Interface &gt; L2TP Server</p></li>
<li><p>Click enabled</p></li>
<li><p>Use IPsec: yes</p></li>
<li><p>Enter IPsec Secret (this is the PSK that will be for client-to site and site-to-site connections, because we must use one profile for both configurations)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<img alt="../_images/mikrotik-l2tp-l2l-1.png" src="../_images/mikrotik-l2tp-l2l-1.png" />
<ul>
<li><p>PPP User Configuration</p>
<blockquote>
<div><ul class="simple">
<li><p>PPP &gt; Secrets</p></li>
<li><p>User: username</p></li>
<li><p>Password (put in password that will be used by the client - not the same as the PSK we setup above)</p></li>
<li><p>Local Address: 172.16.19.1 (or any local IP address)</p></li>
<li><p>Remote Address: 172.16.19.2 (or any local address that can reach local address)</p></li>
<li><p>Routes: put in static route, for example: 192.168.100.0/23 172.16.19.2</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<img alt="../_images/mikrotik-l2tp-l2l-2.png" src="../_images/mikrotik-l2tp-l2l-2.png" />
<p><strong>On your other router:</strong></p>
<ul>
<li><p>Create the PPP Profile</p>
<blockquote>
<div><ul class="simple">
<li><p>PPP &gt; Profiles</p></li>
<li><p>Name: Put the name of the ppp profile</p></li>
<li><p>Protocols tab &gt; Use Encryption: yes</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<img alt="../_images/mikrotik-l2tp-l2l-5.png" src="../_images/mikrotik-l2tp-l2l-5.png" />
<img alt="../_images/mikrotik-l2tp-l2l-6.png" src="../_images/mikrotik-l2tp-l2l-6.png" />
<ul>
<li><p>L2TP Client Configuration</p>
<blockquote>
<div><ul>
<li><p>Interfaces &gt; + &gt; L2TP Client</p></li>
<li><p>General:</p>
<blockquote>
<div><ul class="simple">
<li><p>Name: enter name of interface</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Dialout:</p>
<blockquote>
<div><ul class="simple">
<li><p>Connect To: public IP Address of main router</p></li>
<li><p>User: user</p></li>
<li><p>Password: put in your users password</p></li>
<li><p>Profile: select the profile you created</p></li>
<li><p>Use IPsec</p></li>
<li><p>IPSec secret: enter your ipsec secret</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<img alt="../_images/mikrotik-l2tp-l2l-7.png" src="../_images/mikrotik-l2tp-l2l-7.png" />
<img alt="../_images/mikrotik-l2tp-l2l-8.png" src="../_images/mikrotik-l2tp-l2l-8.png" />
<ul>
<li><p>Static Router Configuration</p>
<blockquote>
<div><ul class="simple">
<li><p>IP &gt; Routes</p></li>
<li><p>DST Address: remote subnet</p></li>
<li><p>Gateway: name of your L2TP interface</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<img alt="../_images/mikrotik-l2tp-l2l-9.png" src="../_images/mikrotik-l2tp-l2l-9.png" />
</section>
<section id="l2tp-client-to-site">
<h3>L2TP Client-to-Site<a class="headerlink" href="#l2tp-client-to-site" title="Permalink to this headline"></a></h3>
<p><strong>Pool</strong></p>
<ul class="simple">
<li><p>IP &gt; Pools &gt; create IP pool</p></li>
</ul>
<img alt="../_images/mikrotik-l2tp-c2s-1.png" src="../_images/mikrotik-l2tp-c2s-1.png" />
<p><strong>L2TP Profile</strong></p>
<ul>
<li><p>PPP &gt; Profiles:</p>
<blockquote>
<div><ul class="simple">
<li><p>Name: L2TP Client-to-Site</p></li>
<li><p>Local Address: the local address of your router</p></li>
<li><p>Remote Address: l2tppool</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<img alt="../_images/mikrotik-l2tp-c2s-2.png" src="../_images/mikrotik-l2tp-c2s-2.png" />
<img alt="../_images/mikrotik-l2tp-c2s-3.png" src="../_images/mikrotik-l2tp-c2s-3.png" />
<p><strong>L2TP Server</strong></p>
<ul class="simple">
<li><p>PPP &gt; Interface &gt; L2TP Server</p></li>
</ul>
<img alt="../_images/mikrotik-l2tp-c2s-4.png" src="../_images/mikrotik-l2tp-c2s-4.png" />
<p><strong>IPSec Proposal</strong></p>
<ul class="simple">
<li><p>IP &gt; IPsec &gt; Proposals</p></li>
</ul>
<img alt="../_images/mikrotik-l2tp-c2s-6.png" src="../_images/mikrotik-l2tp-c2s-6.png" />
<p><strong>IPSec Profile</strong></p>
<ul class="simple">
<li><p>IP &gt; IPsec &gt; Profiles</p></li>
</ul>
<img alt="../_images/mikrotik-l2tp-c2s-7.png" src="../_images/mikrotik-l2tp-c2s-7.png" />
</section>
<section id="gre-ipsec">
<h3>GRE IPSec<a class="headerlink" href="#gre-ipsec" title="Permalink to this headline"></a></h3>
<img alt="../_images/mikrotik-gre-1.png" src="../_images/mikrotik-gre-1.png" />
<img alt="../_images/mikrotik-gre-2.png" src="../_images/mikrotik-gre-2.png" />
<img alt="../_images/mikrotik-gre-3.png" src="../_images/mikrotik-gre-3.png" />
</section>
<section id="sstp">
<h3>SSTP<a class="headerlink" href="#sstp" title="Permalink to this headline"></a></h3>
<p><strong>What is SSTP:</strong></p>
<ul class="simple">
<li><p>SSTP means Secure Socket Tunneling Protocol</p></li>
<li><p>SSTP is a VPN protocol developed my Microsoft and introduced by them with Windows Vista</p></li>
<li><p>SSTP is considered a safe VPN Protocol</p></li>
<li><p>SSTP uses TCP port 443 - the same port used by HTTPS traiffic</p></li>
<li><p>SSTP can bypass NAT firewalls</p></li>
<li><p>On Mikrotik, SSTP supports site to site and client to site VPN tunneling</p></li>
</ul>
<p><strong>Advantages:</strong></p>
<ul class="simple">
<li><p>SSTP encryption offers a decent level of security</p></li>
<li><p>Easy configuration</p></li>
<li><p>Very difficult to block SSTP because it uses TCP port 443 (same as HTTPS)</p></li>
<li><p>Very stable</p></li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul class="simple">
<li><p>SSTP protocol clients are available on limited number of platforms (Windows, Android, etc.)</p></li>
<li><p>Possible TCP meltdown problem</p></li>
</ul>
<p><strong>Site to Site Configuration:</strong></p>
<ul>
<li><p>On the main router:</p></li>
<li><p>PPP &gt; Interface &gt; SSTP Server</p></li>
<li><p>PPP &gt; Secrets &gt; +</p>
<blockquote>
<div><ul class="simple">
<li><p>Name: put a name here</p></li>
<li><p>Password: put a password here</p></li>
<li><p>Profile: select the default-encryption profile or a profile you created</p></li>
<li><p>Local address: the local address of your router</p></li>
<li><p>Remote address: the local address of the other router</p></li>
</ul>
</div></blockquote>
</li>
<li><p>System &gt; Certificates &gt; +</p>
<blockquote>
<div><ul class="simple">
<li><p>Name: CA-Template</p></li>
<li><p>Common Name: public IP of the router</p></li>
<li><p>SAN: IP</p></li>
</ul>
</div></blockquote>
</li>
<li><p>System &gt; Certificates &gt; +</p>
<blockquote>
<div><ul class="simple">
<li><p>Name: Server-Template</p></li>
<li><p>Common Name: server</p></li>
<li><p>SAN: IP</p></li>
</ul>
</div></blockquote>
</li>
<li><p>System &gt; Certificates &gt; +</p>
<blockquote>
<div><ul class="simple">
<li><p>Name: Client-Template</p></li>
<li><p>Common Name: client</p></li>
<li><p>SAN: IP</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>certificate sign CA-Template ca-crl-host<span class="o">=</span><span class="m">192</span>.16.12.1 <span class="nv">name</span><span class="o">=</span>myca
certificate sign Server-Template <span class="nv">ca</span><span class="o">=</span>myca <span class="nv">name</span><span class="o">=</span>server
certificate sign Client-Template <span class="nv">ca</span><span class="o">=</span>myca <span class="nv">name</span><span class="o">=</span>client
certicicate <span class="nb">set</span> server <span class="nv">trusted</span><span class="o">=</span>yes
certificate <span class="nb">set</span> client <span class="nv">trusted</span><span class="o">=</span>yes
certificate export-certificate myca export-passphrase<span class="o">=</span><span class="m">12345678</span>
certificate export-certificate client export-passphrase<span class="o">=</span><span class="m">12345678</span>
</pre></div>
</div>
<ul>
<li><p>PPP &gt; Interface &gt; SSTP Server &gt; Certificate: server</p></li>
<li><p>On the branch router:</p></li>
<li><p>PPP &gt; Interface &gt; + &gt; SSTP Client &gt; Dial Out</p>
<blockquote>
<div><ul class="simple">
<li><p>Connect to: public IP of main router</p></li>
<li><p>User: the username</p></li>
<li><p>Password: the password</p></li>
</ul>
</div></blockquote>
</li>
<li><p>System &gt; Certificates &gt; Import &gt; myca.crt</p></li>
<li><p>System &gt; Certificates &gt; Import &gt; myca.key</p></li>
<li><p>System &gt; Certificates &gt; Import &gt; client.crt</p></li>
<li><p>System &gt; Certifiicates &gt; Imports &gt; client.key</p></li>
<li><p>PPP &gt; Interface &gt; SSTP &gt; certificate: client</p></li>
<li><p>Add a route to the local network on each router (IP &gt; Route)</p></li>
</ul>
<p><strong>Client to Site Configuration:</strong></p>
<ul>
<li><p>PPP &gt; Interface &gt; SSTP Server</p></li>
<li><p>PPP &gt; Secrets &gt; +</p></li>
<li><p>System &gt; Certificates &gt; +</p>
<blockquote>
<div><ul class="simple">
<li><p>Name: CA-Template</p></li>
<li><p>Common Name: public IP of the router</p></li>
<li><p>SAN: IP</p></li>
</ul>
</div></blockquote>
</li>
<li><p>System &gt; Certificates &gt; +</p>
<blockquote>
<div><ul class="simple">
<li><p>Name: Server-Template</p></li>
<li><p>Common Name: server</p></li>
<li><p>SAN: IP</p></li>
</ul>
</div></blockquote>
</li>
<li><p>System &gt; Certificates &gt; +</p>
<blockquote>
<div><ul class="simple">
<li><p>Name: Client-Template</p></li>
<li><p>Common Name: client</p></li>
<li><p>SAN: IP</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>certificate sign CA-Template ca-crl-host<span class="o">=</span><span class="m">192</span>.16.12.1 <span class="nv">name</span><span class="o">=</span>myca
certificate sign Server-Template <span class="nv">ca</span><span class="o">=</span>myca <span class="nv">name</span><span class="o">=</span>server
certificate sign Client-Template <span class="nv">ca</span><span class="o">=</span>myca <span class="nv">name</span><span class="o">=</span>client
certicicate <span class="nb">set</span> server <span class="nv">trusted</span><span class="o">=</span>yes
certificate <span class="nb">set</span> client <span class="nv">trusted</span><span class="o">=</span>yes
certificate export-certificate myca export-passphrase<span class="o">=</span><span class="m">12345678</span>
certificate export-certificate client export-passphrase<span class="o">=</span><span class="m">12345678</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Import the client and server certificates to the Windows PC into Trusted Root Certification Authorities</p></li>
</ul>
</section>
<section id="pppoe">
<h3>PPPoE<a class="headerlink" href="#pppoe" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Point-to-point over Ethernet is a layer 2 protocol</p></li>
<li><p>It is often used by ISPs to control access to their networks</p></li>
<li><p>It can be used as a method of access on any layer 2 technology, such as 802.11 or Ethernet</p></li>
<li><p>You cannot reach a PPPoE server through routers. Since its layer 2 protocol, the server can only be reached through the same Ethernet broadcast domain on which the clients are</p></li>
<li><p>IP &gt; Pool</p></li>
<li><p>PPP &gt; Profiles &gt; + &gt; change tcp mss yes</p></li>
<li><p>PPP &gt; Secret</p></li>
<li><p>PPP &gt; PPoE Servers</p></li>
<li><p>On the other router &gt; PPP &gt; PPoE Scan</p></li>
<li><p>On the other router &gt; PPP &gt; Interface &gt; PPPoE client</p></li>
</ul>
</section>
<section id="l2tp-ports-and-protocols">
<h3>L2TP Ports and Protocols<a class="headerlink" href="#l2tp-ports-and-protocols" title="Permalink to this headline"></a></h3>
<p><a class="reference external" href="https://serverfault.com/questions/451381/which-ports-for-ipsec-lt2p">https://serverfault.com/questions/451381/which-ports-for-ipsec-lt2p</a></p>
<ul class="simple">
<li><p>Protocol: UDP, port 500 (for IKE, to manage encryption keys)</p></li>
<li><p>Protocol: UDP, port 4500 (for IPSEC NAT-Traversal mode)</p></li>
<li><p>Protocol: ESP, value 50 (for IPSEC)</p></li>
<li><p>Protocol: AH, value 51 (for IPSEC)</p></li>
</ul>
</section>
</section>
<section id="firewall">
<h2>Firewall<a class="headerlink" href="#firewall" title="Permalink to this headline"></a></h2>
<section id="basics">
<h3>Basics<a class="headerlink" href="#basics" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Stop unauthorized access</p></li>
<li><p>Block unwanted ports</p></li>
<li><p>Classify and mark connections and packets for QOS or Routing policy</p></li>
</ul>
<p><strong>Firewall functions:</strong></p>
<ul class="simple">
<li><p>Filter packets using filter rules</p></li>
<li><p>NAT: SRCNAT and DSTNAT to translate source and destination addresses</p></li>
<li><p>Mangle: to mark connections and/or packets</p></li>
<li><p>RAW: drop or bypass packets before reaching the connection tracking</p></li>
<li><p>Service ports: using NAT helpers</p></li>
</ul>
<p><strong>Chains:</strong></p>
<ul class="simple">
<li><p>Input = to the router</p></li>
<li><p>Output = from the router</p></li>
<li><p>Forward = via the router</p></li>
</ul>
<p><strong>Firewall Basics:</strong></p>
<ul class="simple">
<li><p>Rules processed in order</p></li>
<li><p>If … then</p></li>
<li><p>If not matched, then packet is accepted</p></li>
</ul>
<p><strong>Firewall Actions:</strong></p>
<ul>
<li><p>Passthrough = count packets/bytes</p></li>
<li><p>Drop = discard a packet</p></li>
<li><p>Reject = discard a packet but send ICMP message or TCP reset</p>
<blockquote>
<div><ul class="simple">
<li><p>TCP reset kills a TCP connection instantly</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Tarpit = send ACK flag but dont open the connection</p></li>
</ul>
</section>
<section id="layer-3-chains">
<h3>Layer 3 Chains<a class="headerlink" href="#layer-3-chains" title="Permalink to this headline"></a></h3>
<img alt="../_images/mikrotik-l3-chains.png" src="../_images/mikrotik-l3-chains.png" />
</section>
<section id="connection-states">
<h3>Connection States<a class="headerlink" href="#connection-states" title="Permalink to this headline"></a></h3>
<img alt="../_images/mikrotik-connection-states.png" src="../_images/mikrotik-connection-states.png" />
<ul class="simple">
<li><p><strong>New:</strong> The 1st packet observed by the firewall will be new. The firewall will check the packet and if allow then the next packet going to the other direction of that stream will create an established connection</p></li>
<li><p><strong>Established:</strong> a stream of packetstaht successfully pass both directions of the firewall. Established backets will not be evaluated by the firewall.</p></li>
<li><p><strong>Related:</strong> they are not considered part of the connection itself but related to it.</p></li>
<li><p><strong>Invalid:</strong> packets arrived out-of-order to the router or with invalid sequence number. Advise to drop them always.</p></li>
</ul>
</section>
<section id="rules">
<h3>Rules<a class="headerlink" href="#rules" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>IP &gt; Firewall &gt; +</p></li>
<li><p>Forward rule &gt; Established, Related, accept</p></li>
<li><p>Input rule &gt; Established, Related, accept</p></li>
<li><p>Forward rule &gt; Invalid &gt; drop</p></li>
<li><p>Input rule &gt; Invalid &gt; drop</p></li>
<li><p>Forward rule &gt; allow local lan</p></li>
<li><p>Input rule &gt; local lan accept</p></li>
<li><p>Forward rule &gt; drop anything else</p></li>
<li><p>Input rule &gt; drop anything else</p></li>
</ul>
</section>
<section id="redirect-dns-to-router-s-dns">
<h3>Redirect DNS to Router’s DNS<a class="headerlink" href="#redirect-dns-to-router-s-dns" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>IP &gt; DNS &gt; Allow Remote Requests</p></li>
<li><p>IP &gt; Firewall &gt; dstnat &gt; protocol tcp&amp;udp 53 &gt; action redrirect 53</p></li>
<li><p>IP &gt; DNS &gt; cache</p></li>
</ul>
</section>
<section id="destination-nat">
<h3>Destination NAT<a class="headerlink" href="#destination-nat" title="Permalink to this headline"></a></h3>
<ul>
<li><p>IP &gt; Firewall</p>
<blockquote>
<div><ul class="simple">
<li><p>chain: dstnat</p></li>
<li><p>Protocol: 6 (tcp)</p></li>
<li><p>Dst port: 80</p></li>
<li><p>Action: dst-nat</p></li>
<li><p>To Address: 172.16.1.254</p></li>
<li><p>To Ports: 80</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="fasttrack">
<h3>FastTrack<a class="headerlink" href="#fasttrack" title="Permalink to this headline"></a></h3>
<p>FastTracked packets bypass firewall, connection traffic, simple queues, queue tree with parent=global, ip traffic-flow (restriction removed in 6.33), IP accounting, IPSec, hotspot, universal client, VRF assignment, so it is up to admin to make sure FastTrack doesnt interfere with other config</p>
<ul>
<li><p>Queues &gt; 1M / 1M (on all IPs - so all PCs connected get only 1Mbps)</p></li>
<li><p>IP &gt; Firewall &gt; Mangle</p>
<blockquote>
<div><ul class="simple">
<li><p>Chain: forward</p></li>
<li><p>Src Address: 192.168.88.2</p></li>
<li><p>Action: mark connection</p></li>
<li><p>New Connection Mark: PC-conn</p></li>
</ul>
</div></blockquote>
</li>
<li><p>IP &gt; Firewall &gt; General</p>
<blockquote>
<div><ul class="simple">
<li><p>Chain: forward</p></li>
<li><p>Connection Mark: pc-conn</p></li>
<li><p>Action: fasttrack connection</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="qos">
<h2>QoS<a class="headerlink" href="#qos" title="Permalink to this headline"></a></h2>
<section id="simple-queue">
<h3>Simple Queue<a class="headerlink" href="#simple-queue" title="Permalink to this headline"></a></h3>
<ul>
<li><p>Simple queues limit bandwidth to:</p>
<blockquote>
<div><ul class="simple">
<li><p>client upload</p></li>
<li><p>client download</p></li>
<li><p>client aggregate (download and upload)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Simple queue is applied to a target (mandatory) which can be:</p>
<blockquote>
<div><ul class="simple">
<li><p>An IP Address</p></li>
<li><p>A network subnet</p></li>
<li><p>an interface</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Simple queues work in sequence which means that each packet must go through every simple queue until a match occurs</p></li>
<li><p>Destination is where the target’s traffic is aimed and it is not compulsory as the target</p></li>
<li><p>Queue &gt; Simple Queue &gt; +</p></li>
<li><p>Tools &gt; Bandwidth Test</p></li>
</ul>
</section>
<section id="burst">
<h3>Burst<a class="headerlink" href="#burst" title="Permalink to this headline"></a></h3>
<ul>
<li><p>Burst is important to give extra bandwidth limited time</p></li>
<li><p>Burst Limit = 512K</p></li>
<li><p>Threshold = 192K</p></li>
<li><p>Time = 8s</p></li>
<li><p>First client gets 512Kbps for 3 seconds because:</p>
<blockquote>
<div><ul class="simple">
<li><p>1 sec = 64K (less than threshold then burst is possible)</p></li>
<li><p>2 sec = 128K (less than threshold then burst is possible)</p></li>
<li><p>3 sec = 192K (equal to the threshold then burst end)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<img alt="../_images/mikrotik-burst.png" src="../_images/mikrotik-burst.png" />
<ul>
<li><p>Queue &gt; Simple queue &gt; General &gt; +</p>
<blockquote>
<div><ul class="simple">
<li><p>Max Limit: 3M</p></li>
<li><p>Burst Limit: 5M</p></li>
<li><p>Burst Threshold: 2M</p></li>
<li><p>Burst time: 10s</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Bandwidth limit divided by time. On the first second you’ll get 500Kbps extra, etc. until the Burst Limit is reached. Then the speed will go back to normal.</p>
</section>
<section id="per-connection-queue-pcq">
<h3>Per Connection Queue (PCQ)<a class="headerlink" href="#per-connection-queue-pcq" title="Permalink to this headline"></a></h3>
<img alt="../_images/mikrotik-pcq-1.png" src="../_images/mikrotik-pcq-1.png" />
<img alt="../_images/mikrotik-pcq-2.png" src="../_images/mikrotik-pcq-2.png" />
<ul>
<li><p>Queues &gt; Queue Types &gt; copy pcq upload</p>
<blockquote>
<div><ul class="simple">
<li><p>Type Name: PCQ Upload</p></li>
<li><p>Rate: 0</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Queues &gt; Queue Types &gt; copy pcq download</p>
<blockquote>
<div><ul class="simple">
<li><p>Type Name: PCQ Download</p></li>
<li><p>Rate: 0</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Queues &gt; General &gt; Simple queue &gt; +</p>
<blockquote>
<div><ul class="simple">
<li><p>Queue Type: PCQ Upload/Download</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="tools">
<h2>Tools<a class="headerlink" href="#tools" title="Permalink to this headline"></a></h2>
<section id="ping">
<h3>Ping<a class="headerlink" href="#ping" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Tools &gt; Ping</p></li>
</ul>
</section>
<section id="traceroute">
<h3>Traceroute<a class="headerlink" href="#traceroute" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Tools &gt; Traceroute</p></li>
</ul>
</section>
<section id="profile">
<h3>Profile<a class="headerlink" href="#profile" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Tools &gt; Profile</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tool profile
</pre></div>
</div>
</section>
</section>
<section id="emails">
<h2>Emails<a class="headerlink" href="#emails" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Tools &gt; Email</p></li>
</ul>
</section>
<section id="netwatch">
<h2>Netwatch<a class="headerlink" href="#netwatch" title="Permalink to this headline"></a></h2>
<ul>
<li><p>Tools &gt; Netwatch &gt; +</p>
<blockquote>
<div><ul class="simple">
<li><p>Up: /tool e-mail send <a class="reference external" href="mailto:to=calebsargeant&#37;&#52;&#48;gmail&#46;com">to=calebsargeant<span>&#64;</span>gmail<span>&#46;</span>com</a> subject=”Router is up” body=”Router is up on $[/system clock get time]”</p></li>
<li><p>Down: /tool e-mail send <a class="reference external" href="mailto:to=calebsargeant&#37;&#52;&#48;gmail&#46;com">to=calebsargeant<span>&#64;</span>gmail<span>&#46;</span>com</a> subject=”Router is down” body=”Router is up on $[/system clock get time]”</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="monitoring">
<h2>Monitoring<a class="headerlink" href="#monitoring" title="Permalink to this headline"></a></h2>
<section id="torch">
<h3>Torch<a class="headerlink" href="#torch" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Tools &gt; Torch</p></li>
</ul>
</section>
<section id="graphing">
<h3>Graphing<a class="headerlink" href="#graphing" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Tools &gt; Graphing &gt; Interface rules</p></li>
<li><p>Tools &gt; Graphing &gt; Resource rules</p></li>
<li><p><a class="reference external" href="http://ip">http://ip</a> of mikrotik/graphs</p></li>
</ul>
</section>
<section id="the-dude">
<h3>The Dude<a class="headerlink" href="#the-dude" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Dude &gt; Settings</p></li>
<li><p>Install the dude on your PC</p></li>
<li><p>Open it up and click discover, put in your subnet</p></li>
</ul>
</section>
</section>
<section id="wireless">
<h2>Wireless<a class="headerlink" href="#wireless" title="Permalink to this headline"></a></h2>
<section id="terminology">
<h3>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline"></a></h3>
<p><strong>What is wireless?</strong></p>
<ul class="simple">
<li><p>RouterOS supports various radio modules that allow comminication over the air (2.4GHz and 5GHz)</p></li>
<li><p>MikroTik RouterOS provides a complete support for IEEE 802.11a, 802.11b, 802.11g, 802.11n and 802.11ac wireless networking standards</p></li>
</ul>
<p><strong>Wireless standards</strong></p>
<ul class="simple">
<li><p>IEEE 802.11b - 2.4GHz frequencies, 11Mbps</p></li>
<li><p>IEEE 802.11g - 2.4GHz frequencies, 54Mbps</p></li>
<li><p>IEEE 802.11a - 5GHz frequencies, 54Mbps</p></li>
<li><p>IEEE 802.11n - 2.4GHz - 5GHz 150Mbps (300Mbps)</p></li>
<li><p>IEEE 802.11ac - 5GHz frequencies 1Gbps</p></li>
</ul>
<img alt="../_images/mikrotik-wireless-1.png" src="../_images/mikrotik-wireless-1.png" />
<ul class="simple">
<li><p>802.11b,g frequency range</p></li>
<li><p>Channels 1,6 and 11 non-overlapping</p></li>
</ul>
<img alt="../_images/mikrotik-wireless-2.png" src="../_images/mikrotik-wireless-2.png" />
<img alt="../_images/mikrotik-wireless-3.png" src="../_images/mikrotik-wireless-3.png" />
<p><strong>Supported Frequencies</strong></p>
<p>Depending on your country regulations wireless card might support</p>
<ul class="simple">
<li><p>2.4GHz: 2312 - 2499 MHz</p></li>
<li><p>5GHz: 4920 - 6100 MHz</p></li>
</ul>
</section>
<section id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Wireless &gt; Security Profiles &gt; +</p></li>
<li><p>Wireless &gt; WiFi Interface &gt; enable and configure, select the Security Profile</p></li>
<li><p>you can use freq usage to check which frequency has little usage</p></li>
<li><p>you can use Snooper to see what’s connecting via wifi</p></li>
</ul>
</section>
<section id="station">
<h3>Station<a class="headerlink" href="#station" title="Permalink to this headline"></a></h3>
<p>Make the router a client (nobody connected to that router can get internet)</p>
<ul class="simple">
<li><p>Wireless &gt; mode station</p></li>
</ul>
</section>
<section id="mac-filtering">
<h3>Mac Filtering<a class="headerlink" href="#mac-filtering" title="Permalink to this headline"></a></h3>
<p>Default Authenticate allows clients to authenticate. Turning it off you must use Wireless &gt; Access list to allow certain clients to access your wifi.</p>
<p>Default forward disabled prevents wifi clients from communicating to each other in the wifi.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cisco/virl.html" class="btn btn-neutral float-left" title="VIRL" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="fortigate.html" class="btn btn-neutral float-right" title="FortiGate" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Caleb Sargeant.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>